(this["webpackJsonpreact-sqljs-demo"]=this["webpackJsonpreact-sqljs-demo"]||[]).push([[0],{116:function(e,t,a){e.exports=a(255)},121:function(e,t,a){},126:function(e,t){},128:function(e,t){},161:function(e,t){},162:function(e,t){},255:function(e,t,a){"use strict";a.r(t);var n=a(0),s=a.n(n),l=a(107),c=a.n(l),o=a(113),r=(a(121),a(108)),i=a.n(r),u=a(112),h=a(58),d=a.n(h),m=a(279),E=a(289),f=a(283),p=a(285),g=a(281),S=a(288),v=a(284),y=a(282),b=a(273),x=a(275),F=a(276),A=a(278),C=a(286),T=a(274),k=a(277),O=a(290),R=a(287);class D extends s.a.Component{constructor(){super(),this.state={loading:!0,db:null,err:null,results:null,states:[],counties:[],stateValue:"USA (all states)",countyValue:null,dates:[],dateAfter:"all",dateBefore:"all",scale:"linear"}}componentDidMount(){i()().then(e=>{this.setState({db:new e.Database},()=>{this.syncData()})}).catch(e=>this.setState({err:e}))}syncData(){this.exec("DROP TABLE IF EXISTS covid_counties;"),this.exec("CREATE TABLE covid_counties (date TEXT, county TEXT, state TEXT, fips INTEGER, cases INTEGER, deaths INTEGER);"),u.a("https://raw.githubusercontent.com/nytimes/covid-19-data/master/us-counties.csv").then(e=>{for(let r=0,i=e.length;r<i;r+=100){let t=e.slice(r,r+100).map(e=>'("'.concat(e.date,'","').concat(e.county,'","').concat(e.state,'",').concat(e.fips||0,",").concat(e.cases,",").concat(e.deaths,")")).join(",\n"),a="INSERT INTO covid_counties (date, county, state, fips, cases, deaths)\nVALUES\n".concat(t,";");this.exec(a)}let t=this.state.db.exec("SELECT DISTINCT state FROM covid_counties ORDER BY state"),a=t[0].values;t=this.state.db.exec("SELECT DISTINCT date FROM covid_counties ORDER BY date");let n=t[0].values;const s=d.a.parse(window.location.search);console.log(s.json);let l=s.json?JSON.parse(s.json):{},c=[],o=l.state||"USA (all states)";"USA (all states)"!==o&&(c=this.getCounties(o)),this.setState({loading:!1,states:a,dates:n,stateValue:l.state||"USA (all states)",countyValue:l.county||null,dateAfter:l.after||"all",dateBefore:l.before||"all",scale:l.scale||"linear",counties:c},()=>{this.qFromSelects()})})}inputDebounce(e,t=!1){clearTimeout(this.debounce),this.debounce=setTimeout(()=>{this.exec(e,t)},500)}exec(e,t=!1){let a=null,n=null;try{a=this.state.db.exec(e)}catch(s){n=s}this.setState({results:a,err:n},()=>{if(t){let t=encodeURIComponent(e);window.history.replaceState(null,"","?q=".concat(t))}})}getCounties(e){return this.state.db.exec('SELECT DISTINCT county FROM covid_counties WHERE state="'.concat(e,'" ORDER BY county'))[0].values}handleStateChange(e){let t=[],a=e.target.value;"USA (all states)"!==a&&(t=this.getCounties(a)),this.setState({stateValue:e.target.value,counties:t,countyValue:"All (entire state)"},()=>{this.qFromSelects()})}handleCountyChange(e){e.target.value;this.setState({countyValue:e.target.value},()=>{this.qFromSelects()})}handleDateAfterChange(e){this.setState({dateAfter:e.target.value},()=>{this.qFromSelects()})}handleDateBeforeChange(e){this.setState({dateBefore:e.target.value},()=>{this.qFromSelects()})}handleScaleChange(e){this.setState({scale:e.target.value},()=>{this.qFromSelects()})}qFromSelects(){let e=[];"USA (all states)"!==this.state.stateValue&&(e.push('state="'.concat(this.state.stateValue,'" ')),"All (entire state)"!==this.state.countyValue&&e.push('county="'.concat(this.state.countyValue,'"'))),"all"!==this.state.dateAfter&&e.push('date >= "'.concat(this.state.dateAfter,'"')),"all"!==this.state.dateBefore&&e.push('date <= "'.concat(this.state.dateBefore,'"'));let t=e.length>0&&"WHERE ".concat(e.join(" AND ")),a="SELECT date, SUM(cases) AS cases, SUM(deaths) AS deaths FROM covid_counties ".concat(t," GROUP BY (date)");this.exec(a);let n=encodeURIComponent,s=JSON.stringify({state:this.state.stateValue,county:this.state.countyValue,after:this.state.dateAfter,before:this.state.dateBefore,scale:this.state.scale});window.history.replaceState(null,"","?json=".concat(n(s)))}graphSelector(){return s.a.createElement("div",{class:"selectors"},s.a.createElement("label",{for:"state"},"State"),s.a.createElement("select",{name:"state",value:this.state.stateValue,onChange:e=>this.handleStateChange(e)},s.a.createElement("option",{value:"USA (all states)"},"USA (all states)"),this.state.states.map(e=>s.a.createElement("option",{value:e},e))),s.a.createElement("label",{for:"county"},"County"),s.a.createElement("select",{name:"county",value:this.state.countyValue,onChange:e=>this.handleCountyChange(e)},"USA (all states)"!==this.state.stateValue&&s.a.createElement("option",{value:"All (entire state)"},"All (entire state)"),this.state.counties.map(e=>s.a.createElement("option",{value:e},e))),s.a.createElement("label",{for:"daterange"},"Date range"),s.a.createElement("select",{name:"daterange",value:this.state.dateAfter,onChange:e=>this.handleDateAfterChange(e)},s.a.createElement("option",{value:"all"}," -- beginning date -- "),this.state.dates.map(e=>s.a.createElement("option",{value:e},e))),s.a.createElement("select",{value:this.state.dateBefore,onChange:e=>this.handleDateBeforeChange(e)},s.a.createElement("option",{value:"all"}," -- end date -- "),this.state.dates.map(e=>s.a.createElement("option",{value:e},e))))}graphData({columns:e,values:t},a,n){const l=e.indexOf("date"),c=e.indexOf("cases"),r=e.indexOf("deaths");function i(e){return e<=300?2:300<e&&e<=400?5:10}const u=O.b("%Y-%m-%d"),h=e=>u(e[l]),d=e=>+e[c],C=a-60-60,D=n-60-60,w=Object(b.a)({range:[0,C],domain:Object(T.a)(t,h)}),V=Object(x.a)({range:[0,C],domain:t.map(h)}),j="linear"===this.state.scale?Object(F.a)({range:[D,0],domain:[0,Object(k.a)(t,d)]}):Object(A.a)({range:[D,0],domain:Object(T.a)(t,d)});return s.a.createElement("svg",{width:a,height:n},s.a.createElement("rect",{x:0,y:0,width:a,height:n,fill:"#242424",rx:14}),s.a.createElement(E.a,{top:60,left:60,xScale:w,yScale:j,stroke:"rgb(102, 102, 102)",width:C,height:D,numTicksRows:4,numTicksColumns:i(a)}),s.a.createElement(m.a,{top:60,left:60,key:"deaths"},t.map((e,t)=>{const a=h(e),n=V.bandwidth(),l=D-j((e=>+e[r])(e)),c=V(a),o=D-l;return s.a.createElement(g.a,{key:"bar-".concat(t),x:c,y:o,width:n,height:l,fill:"rgba(23, 233, 217, .5)"})})),s.a.createElement(m.a,{key:"lines-1",top:60,left:60},s.a.createElement(S.a,{data:t,x:e=>w(h(e)),y:e=>j(d(e)),stroke:"#ffffff",strokeWidth:2,curve:y.a})),s.a.createElement(m.a,{left:60},s.a.createElement(f.a,{top:60,left:0,scale:j,hideZero:!0,numTicks:4,label:"Cases",tickFormat:R.a("~s"),labelProps:{fill:"#FFF",textAnchor:"middle",fontSize:12,fontFamily:"Arial"},stroke:"#FFF",tickStroke:"#FFF",tickLabelProps:(e,t)=>({fill:"#FFF",textAnchor:"end",fontSize:10,fontFamily:"Arial",dx:"-0.25em",dy:"0.25em"}),tickComponent:e=>{let t=e.formattedValue,a=Object(o.a)(e,["formattedValue"]);return s.a.createElement("text",a,t)}}),s.a.createElement(p.a,{top:n-60,left:0,scale:w,numTicks:i(a),label:"Date"},e=>{const t=(e.axisToPoint.x-e.axisFromPoint.x)/2;return s.a.createElement("g",{className:"my-custom-bottom-axis"},e.ticks.map((t,a)=>{const n=t.to.x,l=t.to.y+10+e.tickLength;return s.a.createElement(m.a,{key:"vx-tick-".concat(t.value,"-").concat(a),className:"vx-axis-tick"},s.a.createElement(v.a,{from:t.from,to:t.to,stroke:"#FFF"}),s.a.createElement("text",{transform:"translate(".concat(n,", ").concat(l,") rotate(").concat(45,")"),fontSize:10,textAnchor:"middle",fill:"#FFF"},t.formattedValue))}),s.a.createElement("text",{textAnchor:"middle",transform:"translate(".concat(t,", 50)"),fontSize:"8",fill:"#FFF"},e.label))})))}renderResult({columns:e,values:t}){let a=!1,n=t.length;return t.length>1e3&&(a=!0,t=t.slice(0,1e3)),s.a.createElement("div",null,a&&s.a.createElement("div",null,"truncated: 1,000 of ".concat(n," shown and graph skipped.")),s.a.createElement("table",null,s.a.createElement("thead",null,s.a.createElement("tr",null,e.map(e=>s.a.createElement("td",null,e)))),s.a.createElement("tbody",null,t.map(e=>s.a.createElement("tr",null,e.map(e=>s.a.createElement("td",null,e)))))))}render(){let e=this.state,t=(e.db,e.err),a=e.results,n=e.loading;d.a.parse(window.location.search);return n?s.a.createElement("pre",null,"Loading..."):s.a.createElement("div",{className:"App"},s.a.createElement("pre",{className:"error"},(t||"").toString()),this.graphSelector(),a&&s.a.createElement(C.a,{className:"graph-container"},({width:e,height:t})=>a.map(t=>this.graphData(t,e,500))),s.a.createElement("label",{for:"scale"},"Scale"),s.a.createElement("select",{name:"scale",value:this.state.scale,onChange:e=>this.handleScaleChange(e)},s.a.createElement("option",{value:"linear"},"linear"),s.a.createElement("option",{value:"log"},"log")))}}const w=document.getElementById("root");c.a.render(s.a.createElement(s.a.StrictMode,null,s.a.createElement(D,null)),w)}},[[116,1,2]]]);
//# sourceMappingURL=main.00e8cba4.chunk.js.map