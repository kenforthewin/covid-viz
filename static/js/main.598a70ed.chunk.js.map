{"version":3,"sources":["App.js","index.js"],"names":["App","React","Component","constructor","super","this","state","loading","db","err","results","states","counties","stateValue","countyValue","dates","dateAfter","dateBefore","componentDidMount","initSqlJs","then","SQL","setState","Database","syncData","catch","exec","d3Fetch","data","i","j","length","strValues","slice","map","d","date","county","fips","cases","deaths","join","q","values","parsed","queryString","parse","window","location","search","qFromSelects","inputDebounce","sql","setUrl","clearTimeout","debounce","setTimeout","e","encodeURIComponent","history","replaceState","handleStateChange","event","value","target","handleCountyChange","handleDateAfterChange","handleDateBeforeChange","whereClauses","push","whereClause","enc","graphSelector","class","for","name","onChange","s","graphData","columns","width","height","xIndex","indexOf","yIndex","yDeathsIndex","numTicksForHeight","numTicksForWidth","parseDate","d3Time","x","y","xMax","yMax","xScale","scaleTime","range","domain","extent","xDeathsScale","scaleBand","yScale","scaleLinear","max","fill","rx","Grid","top","left","stroke","numTicksRows","numTicksColumns","Group","key","barWidth","bandwidth","barHeight","yDeaths","barX","barY","Bar","LinePath","strokeWidth","curve","curveMonotoneX","AxisLeft","scale","hideZero","numTicks","label","labelProps","textAnchor","fontSize","fontFamily","tickStroke","tickLabelProps","index","dx","dy","tickComponent","formattedValue","tickProps","AxisBottom","axis","axisCenter","axisToPoint","axisFromPoint","className","ticks","tick","tickX","to","tickY","tickLength","Line","from","transform","renderResult","truncated","columnName","row","render","toString","ParentSize","w","h","rootElement","document","getElementById","ReactDOM","StrictMode"],"mappings":"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","file":"static/js/main.598a70ed.chunk.js","sourcesContent":["import React from \"react\";\nimport \"./styles.css\";\nimport initSqlJs from \"sql.js\";\nimport * as d3Fetch from \"d3-fetch\";\nimport queryString from \"query-string\";\nimport { Group } from \"@vx/group\";\nimport { Grid } from \"@vx/grid\";\nimport { AxisLeft, AxisBottom } from \"@vx/axis\";\nimport { LinePath, Line, Bar } from \"@vx/shape\";\nimport { curveMonotoneX } from \"@vx/curve\";\nimport { scaleTime, scaleLinear, scaleBand } from \"@vx/scale\";\nimport { ParentSize } from \"@vx/responsive\";\n\nimport { extent, max, min } from \"d3-array\";\nimport * as d3Time from \"d3-time-format\";\n\nexport default class App extends React.Component {\n  constructor() {\n    super();\n    this.state = {\n      loading: true,\n      db: null,\n      err: null,\n      results: null,\n      states: [],\n      counties: [],\n      stateValue: \"USA (all states)\",\n      countyValue: null,\n      dates: [],\n      dateAfter: \"all\",\n      dateBefore: \"all\"\n    };\n  }\n\n  componentDidMount() {\n    // sql.js needs to fetch its wasm file, so we cannot immediately instantiate the database\n    // without any configuration, initSqlJs will fetch the wasm files directly from the same path as the js\n    // see ../config-overrides.js\n\n    initSqlJs()\n      .then(SQL => {\n        this.setState({ db: new SQL.Database() }, () => {\n          this.syncData();\n        });\n      })\n      .catch(err => this.setState({ err }));\n  }\n\n  syncData() {\n    this.exec(\"DROP TABLE IF EXISTS covid_counties;\");\n    this.exec(\n      \"CREATE TABLE covid_counties (date TEXT, county TEXT, state TEXT, fips INTEGER, cases INTEGER, deaths INTEGER);\"\n    );\n\n    d3Fetch\n      .csv(\n        \"https://raw.githubusercontent.com/nytimes/covid-19-data/master/us-counties.csv\"\n      )\n      .then(data => {\n        let chunk = 100;\n        for (let i = 0, j = data.length; i < j; i += chunk) {\n          let values = data\n            .slice(i, i + chunk)\n            .map(\n              d =>\n                `(\"${d.date}\",\"${d.county}\",\"${d.state}\",${d.fips || 0},${\n                  d.cases\n                },${d.deaths})`\n            );\n\n          let strValues = values.join(\",\\n\");\n          let q = `INSERT INTO covid_counties (date, county, state, fips, cases, deaths)\\nVALUES\\n${strValues};`;\n          this.exec(q);\n        }\n\n        let results = this.state.db.exec(\n          \"SELECT DISTINCT state FROM covid_counties ORDER BY state\"\n        );\n        let states = results[0].values;\n        results = this.state.db.exec(\n          \"SELECT DISTINCT date FROM covid_counties ORDER BY date\"\n        );\n        let dates = results[0].values;\n        const parsed = queryString.parse(window.location.search);\n        this.setState({\n          loading: false,\n          states,\n          dates,\n          stateValue: parsed[\"state\"],\n          countyValue: parsed[\"county\"],\n          dateAfter: parsed[\"after\"],\n          dateBefore: parsed[\"before\"]\n        });\n        // const parsed = queryString.parse(window.location.search);\n        // if (parsed[\"q\"]) {\n        //   this.exec(parsed[\"q\"]);\n        // } else {\n\n        // }\n        this.qFromSelects();\n      });\n  }\n\n  inputDebounce(sql, setUrl = false) {\n    clearTimeout(this.debounce);\n    this.debounce = setTimeout(() => {\n      this.exec(sql, setUrl);\n    }, 500);\n  }\n\n  exec(sql, setUrl = false) {\n    let results = null,\n      err = null;\n    try {\n      // The sql is executed synchronously on the UI thread.\n      // You may want to use a web worker\n      results = this.state.db.exec(sql); // an array of objects is returned\n    } catch (e) {\n      // exec throws an error when the SQL statement is invalid\n      err = e;\n    }\n    this.setState({ results, err }, () => {\n      if (setUrl) {\n        let q = encodeURIComponent(sql);\n        window.history.replaceState(null, \"\", `?q=${q}`);\n      }\n    });\n  }\n\n  handleStateChange(event) {\n    let counties = [];\n    let value = event.target.value;\n    if (value !== \"USA (all states)\") {\n      let results = this.state.db.exec(\n        `SELECT DISTINCT county FROM covid_counties WHERE state=\"${value}\" ORDER BY county`\n      );\n      counties = results[0].values;\n    }\n    this.setState(\n      {\n        stateValue: event.target.value,\n        counties,\n        countyValue: \"All (entire state)\"\n      },\n      () => {\n        this.qFromSelects();\n      }\n    );\n  }\n\n  handleCountyChange(event) {\n    let value = event.target.value;\n    this.setState({ countyValue: event.target.value }, () => {\n      this.qFromSelects();\n    });\n  }\n\n  handleDateAfterChange(event) {\n    this.setState({ dateAfter: event.target.value }, () => {\n      this.qFromSelects();\n    });\n  }\n\n  handleDateBeforeChange(event) {\n    this.setState({ dateBefore: event.target.value }, () => {\n      this.qFromSelects();\n    });\n  }\n\n  qFromSelects() {\n    let whereClauses = [];\n    if (this.state.stateValue !== \"USA (all states)\") {\n      whereClauses.push(`state=\"${this.state.stateValue}\" `);\n      if (this.state.countyValue !== \"All (entire state)\") {\n        whereClauses.push(`county=\"${this.state.countyValue}\"`);\n      }\n    }\n    if (this.state.dateAfter !== \"all\") {\n      whereClauses.push(`date >= \"${this.state.dateAfter}\"`);\n    }\n    if (this.state.dateBefore !== \"all\") {\n      whereClauses.push(`date <= \"${this.state.dateBefore}\"`);\n    }\n    let whereClause =\n      whereClauses.length > 0 && `WHERE ${whereClauses.join(\" AND \")}`;\n    let q = `SELECT date, SUM(cases) AS cases, SUM(deaths) AS deaths FROM covid_counties ${whereClause} GROUP BY (date)`;\n    this.exec(q);\n\n    let enc = encodeURIComponent;\n    window.history.replaceState(\n      null,\n      \"\",\n      `?state=${enc(this.state.stateValue)}&county=${enc(\n        this.state.countyValue\n      )}&after=${enc(this.state.dateAfter)}&before=${enc(\n        this.state.dateBefore\n      )}`\n    );\n  }\n\n  graphSelector() {\n    return (\n      <div class=\"selectors\">\n        <label for=\"state\">State</label>\n        <select\n          name=\"state\"\n          value={this.state.stateValue}\n          onChange={e => this.handleStateChange(e)}\n        >\n          <option value=\"USA (all states)\">USA (all states)</option>\n          {this.state.states.map(s => (\n            <option value={s}>{s}</option>\n          ))}\n        </select>\n        <label for=\"county\">County</label>\n        <select\n          name=\"county\"\n          value={this.state.countyValue}\n          onChange={e => this.handleCountyChange(e)}\n        >\n          {this.state.stateValue !== \"USA (all states)\" && (\n            <option value=\"All (entire state)\">All (entire state)</option>\n          )}\n          {this.state.counties.map(s => (\n            <option value={s}>{s}</option>\n          ))}\n        </select>\n        <label for=\"daterange\">Date range</label>\n        <select\n          name=\"daterange\"\n          value={this.state.dateAfter}\n          onChange={e => this.handleDateAfterChange(e)}\n        >\n          <option value=\"all\"> -- beginning date -- </option>\n          {this.state.dates.map(s => (\n            <option value={s}>{s}</option>\n          ))}\n        </select>\n        <select\n          value={this.state.dateBefore}\n          onChange={e => this.handleDateBeforeChange(e)}\n        >\n          <option value=\"all\"> -- end date -- </option>\n          {this.state.dates.map(s => (\n            <option value={s}>{s}</option>\n          ))}\n        </select>\n      </div>\n    );\n  }\n\n  graphData({ columns, values }, width, height) {\n    const xIndex = columns.indexOf(\"date\");\n    const yIndex = columns.indexOf(\"cases\");\n    const yDeathsIndex = columns.indexOf(\"deaths\");\n\n    // responsive utils for axis ticks\n    function numTicksForHeight(height) {\n      if (height <= 300) return 3;\n      if (300 < height && height <= 600) return 5;\n      return 10;\n    }\n\n    function numTicksForWidth(width) {\n      if (width <= 300) return 2;\n      if (300 < width && width <= 400) return 5;\n      return 10;\n    }\n\n    const parseDate = d3Time.timeParse(\"%Y-%m-%d\");\n    const x = d => parseDate(d[xIndex]);\n    const y = d => d[yIndex];\n    const yDeaths = d => d[yDeathsIndex];\n\n    // bounds\n    const margin = 60;\n    const xMax = width - margin - margin;\n    const yMax = height - margin - margin;\n    // scales\n    const xScale = scaleTime({\n      range: [0, xMax],\n      domain: extent(values, x)\n    });\n    const xDeathsScale = scaleBand({\n      range: [0, xMax],\n      domain: values.map(x)\n    });\n    const yScale = scaleLinear({\n      range: [yMax, 0],\n      domain: [0, max(values, y)]\n    });\n    return (\n      <svg width={width} height={height}>\n        <rect\n          x={0}\n          y={0}\n          width={width}\n          height={height}\n          fill=\"#242424\"\n          rx={14}\n        />\n        <Grid\n          top={margin}\n          left={margin}\n          xScale={xScale}\n          yScale={yScale}\n          stroke=\"rgb(102, 102, 102)\"\n          width={xMax}\n          height={yMax}\n          numTicksRows={numTicksForHeight(height)}\n          numTicksColumns={numTicksForWidth(width)}\n        />\n        <Group top={margin} left={margin} key=\"deaths\">\n          {values.map((d, i) => {\n            const date = x(d);\n            const barWidth = xDeathsScale.bandwidth();\n            const barHeight = yMax - yScale(yDeaths(d));\n            const barX = xDeathsScale(date);\n            const barY = yMax - barHeight;\n            return (\n              <Bar\n                key={`bar-${i}`}\n                x={barX}\n                y={barY}\n                width={barWidth}\n                height={barHeight}\n                fill=\"rgba(23, 233, 217, .5)\"\n              />\n            );\n          })}\n        </Group>\n        <Group key={`lines-1`} top={margin} left={margin}>\n          <LinePath\n            data={values}\n            x={d => xScale(x(d))}\n            y={d => yScale(y(d))}\n            stroke={\"#ffffff\"}\n            strokeWidth={2}\n            curve={curveMonotoneX}\n          />\n        </Group>\n        <Group left={margin}>\n          <AxisLeft\n            top={margin}\n            left={0}\n            scale={yScale}\n            hideZero\n            numTicks={numTicksForHeight(height)}\n            label=\"Cases\"\n            labelProps={{\n              fill: \"#FFF\",\n              textAnchor: \"middle\",\n              fontSize: 12,\n              fontFamily: \"Arial\"\n            }}\n            stroke=\"#FFF\"\n            tickStroke=\"#FFF\"\n            tickLabelProps={(value, index) => ({\n              fill: \"#FFF\",\n              textAnchor: \"end\",\n              fontSize: 10,\n              fontFamily: \"Arial\",\n              dx: \"-0.25em\",\n              dy: \"0.25em\"\n            })}\n            tickComponent={({ formattedValue, ...tickProps }) => (\n              <text {...tickProps}>{formattedValue}</text>\n            )}\n          />\n          <AxisBottom\n            top={height - margin}\n            left={0}\n            scale={xScale}\n            numTicks={numTicksForWidth(width)}\n            label=\"Date\"\n          >\n            {axis => {\n              const tickLabelSize = 10;\n              const tickRotate = 45;\n              const tickColor = \"#FFF\";\n              const axisCenter =\n                (axis.axisToPoint.x - axis.axisFromPoint.x) / 2;\n              return (\n                <g className=\"my-custom-bottom-axis\">\n                  {axis.ticks.map((tick, i) => {\n                    const tickX = tick.to.x;\n                    const tickY = tick.to.y + tickLabelSize + axis.tickLength;\n                    return (\n                      <Group\n                        key={`vx-tick-${tick.value}-${i}`}\n                        className={\"vx-axis-tick\"}\n                      >\n                        <Line\n                          from={tick.from}\n                          to={tick.to}\n                          stroke={tickColor}\n                        />\n                        <text\n                          transform={`translate(${tickX}, ${tickY}) rotate(${tickRotate})`}\n                          fontSize={tickLabelSize}\n                          textAnchor=\"middle\"\n                          fill={tickColor}\n                        >\n                          {tick.formattedValue}\n                        </text>\n                      </Group>\n                    );\n                  })}\n                  <text\n                    textAnchor=\"middle\"\n                    transform={`translate(${axisCenter}, 50)`}\n                    fontSize=\"8\"\n                    fill=\"#FFF\"\n                  >\n                    {axis.label}\n                  </text>\n                </g>\n              );\n            }}\n          </AxisBottom>\n        </Group>\n      </svg>\n    );\n  }\n\n  /**\n   * Renders a single value of the array returned by db.exec(...) as a table\n   */\n  renderResult({ columns, values }) {\n    let truncated = false;\n    let length = values.length;\n    if (values.length > 1000) {\n      truncated = true;\n      values = values.slice(0, 1000);\n    }\n    return (\n      <div>\n        {truncated && (\n          <div>{`truncated: 1,000 of ${length} shown and graph skipped.`}</div>\n        )}\n        <table>\n          <thead>\n            <tr>\n              {columns.map(columnName => (\n                <td>{columnName}</td>\n              ))}\n            </tr>\n          </thead>\n\n          <tbody>\n            {values.map((\n              row // values is an array of arrays representing the results of the query\n            ) => (\n              <tr>\n                {row.map(value => (\n                  <td>{value}</td>\n                ))}\n              </tr>\n            ))}\n          </tbody>\n        </table>\n      </div>\n    );\n  }\n\n  render() {\n    let { db, err, results, loading } = this.state;\n    const parsed = queryString.parse(window.location.search);\n    if (loading) return <pre>Loading...</pre>;\n    return (\n      <div className=\"App\">\n        {/* <textarea\n          rows={3}\n          defaultValue={parsed[\"q\"]}\n          onChange={e => this.inputDebounce(e.target.value, true)}\n          placeholder=\"Enter some SQL. Try “SELECT * FROM covid_counties;”\"\n        ></textarea> */}\n        <pre className=\"error\">{(err || \"\").toString()}</pre>\n        {this.graphSelector()}\n        {results && (\n          <ParentSize className=\"graph-container\">\n            {({ width: w, height: h }) => {\n              return results.map(d => this.graphData(d, w, 500));\n            }}\n          </ParentSize>\n        )}\n\n        {/* <pre>\n          {results\n            ? results.map(this.renderResult) // results contains one object per select statement in the query\n            : \"\"}\n        </pre> */}\n      </div>\n    );\n  }\n}\n","import React from \"react\";\nimport ReactDOM from \"react-dom\";\n\nimport App from \"./App\";\n\nconst rootElement = document.getElementById(\"root\");\nReactDOM.render(\n  <React.StrictMode>\n    <App />\n  </React.StrictMode>,\n  rootElement\n);\n"],"sourceRoot":""}