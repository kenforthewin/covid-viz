(this["webpackJsonpreact-sqljs-demo"]=this["webpackJsonpreact-sqljs-demo"]||[]).push([[0],{113:function(e,t,a){e.exports=a(252)},118:function(e,t,a){},123:function(e,t){},125:function(e,t){},158:function(e,t){},159:function(e,t){},252:function(e,t,a){"use strict";a.r(t);var n=a(0),l=a.n(n),s=a(102),c=a.n(s),o=a(109),r=(a(118),a(103)),i=a.n(r),u=a(108),m=a(104),h=a.n(m),d=a(274),E=a(282),f=a(277),p=a(279),S=a(281),g=a(278),v=a(276),x=a(270),F=a(272),y=a(280),T=a(271),b=a(273),A=a(283);class k extends l.a.Component{constructor(){super(),this.state={loading:!0,db:null,err:null,results:null,states:[],counties:[],stateValue:"USA (all states)",countyValue:null}}componentDidMount(){i()().then(e=>{this.setState({db:new e.Database},()=>{this.syncData()})}).catch(e=>this.setState({err:e}))}syncData(){this.exec("DROP TABLE IF EXISTS covid_counties;"),this.exec("CREATE TABLE covid_counties (date TEXT, county TEXT, state TEXT, fips INTEGER, cases INTEGER, deaths INTEGER);"),u.a("https://raw.githubusercontent.com/nytimes/covid-19-data/master/us-counties.csv").then(e=>{for(let a=0,n=e.length;a<n;a+=100){let t=e.slice(a,a+100).map(e=>'("'.concat(e.date,'","').concat(e.county,'","').concat(e.state,'",').concat(e.fips||0,",").concat(e.cases,",").concat(e.deaths,")")).join(",\n"),n="INSERT INTO covid_counties (date, county, state, fips, cases, deaths)\nVALUES\n".concat(t,";");this.exec(n)}let t=this.state.db.exec("SELECT DISTINCT state FROM covid_counties ORDER BY state")[0].values;this.setState({loading:!1,states:t}),this.qFromSelects()})}inputDebounce(e,t=!1){clearTimeout(this.debounce),this.debounce=setTimeout(()=>{this.exec(e,t)},500)}exec(e,t=!1){let a=null,n=null;try{a=this.state.db.exec(e)}catch(l){n=l}this.setState({results:a,err:n},()=>{if(t){let t=encodeURIComponent(e);window.history.replaceState(null,"","?q=".concat(t))}})}handleStateChange(e){let t=[],a=e.target.value;if("USA (all states)"!==a){t=this.state.db.exec('SELECT DISTINCT county FROM covid_counties WHERE state="'.concat(a,'" ORDER BY county'))[0].values}this.setState({stateValue:e.target.value,counties:t,countyValue:"All (entire state)"},()=>{this.qFromSelects()})}handleCountyChange(e){e.target.value;this.setState({countyValue:e.target.value},()=>{this.qFromSelects()})}qFromSelects(){let e="";"USA (all states)"!==this.state.stateValue&&(e='WHERE state="'.concat(this.state.stateValue,'" '),"All (entire state)"!==this.state.countyValue&&(e+='AND county="'.concat(this.state.countyValue,'"')));let t="SELECT date, SUM(cases) AS cases FROM covid_counties ".concat(e," GROUP BY (date)");this.exec(t)}graphSelector(){return l.a.createElement("div",null,l.a.createElement("select",{value:this.state.stateValue,onChange:e=>this.handleStateChange(e)},l.a.createElement("option",{value:"USA (all states)"},"USA (all states)"),this.state.states.map(e=>l.a.createElement("option",{value:e},e))),l.a.createElement("select",{value:this.state.countyValue,onChange:e=>this.handleCountyChange(e)},"USA (all states)"!==this.state.stateValue&&l.a.createElement("option",{value:"All (entire state)"},"All (entire state)"),this.state.counties.map(e=>l.a.createElement("option",{value:e},e))))}graphData({columns:e,values:t},a,n){if(t.length>1e4)return null;const s=e.indexOf("date");if(-1===s)return l.a.createElement("div",null,"Add a `date` and `cases` column to graph the results.");const c=e.indexOf("cases");if(-1===c)return l.a.createElement("div",null,"Add a `date` and `cases` column to graph the results.");function r(e){return e<=300?3:300<e&&e<=600?5:10}function i(e){return e<=300?2:300<e&&e<=400?5:10}const u=A.b("%Y-%m-%d"),m=e=>u(e[s]),h=e=>e[c],y=a-60-60,k=n-60-60,C=Object(x.a)({range:[0,y],domain:Object(T.a)(t,m)}),R=Object(F.a)({range:[k,0],domain:[0,Object(b.a)(t,h)]});return l.a.createElement("svg",{width:a,height:n},l.a.createElement("rect",{x:0,y:0,width:a,height:n,fill:"#242424",rx:14}),l.a.createElement(E.a,{top:60,left:60,xScale:C,yScale:R,stroke:"rgb(102, 102, 102)",width:y,height:k,numTicksRows:r(n),numTicksColumns:i(a)}),l.a.createElement(d.a,{key:"lines-1",top:60,left:60},l.a.createElement(S.a,{data:t,x:e=>C(m(e)),y:e=>R(h(e)),stroke:"#ffffff",strokeWidth:2,curve:v.a})),l.a.createElement(d.a,{left:60},l.a.createElement(f.a,{top:60,left:0,scale:R,hideZero:!0,numTicks:r(n),label:"Cases",labelProps:{fill:"#FFF",textAnchor:"middle",fontSize:12,fontFamily:"Arial"},stroke:"#FFF",tickStroke:"#FFF",tickLabelProps:(e,t)=>({fill:"#FFF",textAnchor:"end",fontSize:10,fontFamily:"Arial",dx:"-0.25em",dy:"0.25em"}),tickComponent:e=>{let t=e.formattedValue,a=Object(o.a)(e,["formattedValue"]);return l.a.createElement("text",a,t)}}),l.a.createElement(p.a,{top:n-60,left:0,scale:C,numTicks:i(a),label:"Date"},e=>{const t=(e.axisToPoint.x-e.axisFromPoint.x)/2;return l.a.createElement("g",{className:"my-custom-bottom-axis"},e.ticks.map((t,a)=>{const n=t.to.x,s=t.to.y+10+e.tickLength;return l.a.createElement(d.a,{key:"vx-tick-".concat(t.value,"-").concat(a),className:"vx-axis-tick"},l.a.createElement(g.a,{from:t.from,to:t.to,stroke:"#FFF"}),l.a.createElement("text",{transform:"translate(".concat(n,", ").concat(s,") rotate(").concat(45,")"),fontSize:10,textAnchor:"middle",fill:"#FFF"},t.formattedValue))}),l.a.createElement("text",{textAnchor:"middle",transform:"translate(".concat(t,", 50)"),fontSize:"8",fill:"#FFF"},e.label))})))}renderResult({columns:e,values:t}){let a=!1,n=t.length;return t.length>1e3&&(a=!0,t=t.slice(0,1e3)),l.a.createElement("div",null,a&&l.a.createElement("div",null,"truncated: 1,000 of ".concat(n," shown and graph skipped.")),l.a.createElement("table",null,l.a.createElement("thead",null,l.a.createElement("tr",null,e.map(e=>l.a.createElement("td",null,e)))),l.a.createElement("tbody",null,t.map(e=>l.a.createElement("tr",null,e.map(e=>l.a.createElement("td",null,e)))))))}render(){let e=this.state,t=(e.db,e.err),a=e.results,n=e.loading;h.a.parse(window.location.search);return n?l.a.createElement("pre",null,"Loading..."):l.a.createElement("div",{className:"App"},l.a.createElement("pre",{className:"error"},(t||"").toString()),this.graphSelector(),a&&l.a.createElement(y.a,{className:"graph-container"},({width:e,height:t})=>a.map(t=>this.graphData(t,e,500))))}}const C=document.getElementById("root");c.a.render(l.a.createElement(l.a.StrictMode,null,l.a.createElement(k,null)),C)}},[[113,1,2]]]);
//# sourceMappingURL=main.8442a0e8.chunk.js.map